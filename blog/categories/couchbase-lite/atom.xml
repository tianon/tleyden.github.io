<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: couchbase-lite | Seven Story Rabbit Hole]]></title>
  <link href="http://tleyden.github.io/blog/categories/couchbase-lite/atom.xml" rel="self"/>
  <link href="http://tleyden.github.io/"/>
  <updated>2014-11-11T20:47:47-08:00</updated>
  <id>http://tleyden.github.io/</id>
  <author>
    <name><![CDATA[Traun Leyden]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Building Couchbase Lite Android under Jenkins]]></title>
    <link href="http://tleyden.github.io/blog/2014/11/04/building-couchbase-lite-android-under-jenkins/"/>
    <updated>2014-11-04T17:07:00-08:00</updated>
    <id>http://tleyden.github.io/blog/2014/11/04/building-couchbase-lite-android-under-jenkins</id>
    <content type="html"><![CDATA[<h2>Launch Ubuntu 14.04 in AWS</h2>

<ul>
<li>AMI: ubuntu-trusty-14.04-amd64-server-20140927 (ami-98aa1cf0)</li>
<li>Root device type: ebs</li>
<li>Instance type: m3.medium</li>
<li>Network: Ec2-classic</li>
<li>Virtualization type: paravirtual</li>
</ul>


<p><strong>Note</strong>: you will also probably want to open up port 8080 in your security group to all ip addresses, in order to access it from outside AWS.</p>

<h2>Install dependencies</h2>

<p><code>
sudo apt-get update &amp;&amp; sudo apt-get install -y openjdk-7-jre openjdk-7-jdk git gcc-multilib lib32z1 lib32stdc++6
</code></p>

<h2>Install Jenkins</h2>

<p><code>
wget -q -O - https://jenkins-ci.org/debian/jenkins-ci.org.key | sudo apt-key add -
sudo sh -c 'echo deb http://pkg.jenkins-ci.org/debian binary/ &gt; /etc/apt/sources.list.d/jenkins.list'
sudo apt-get update
sudo apt-get -y install jenkins
</code></p>

<h2>Verify Jenkins is running</h2>

<p><code>
curl localhost:8080
</code></p>

<p>and you should see some HTML returned.</p>

<h2>Git plugin</h2>

<p><strong>Install</strong></p>

<ul>
<li>Go to Manage Jenkins / Manage Plugins and click &ldquo;Available&rdquo; tab</li>
<li>Search for &ldquo;Git plugin&rdquo; + install it</li>
</ul>


<p><strong>Configure</strong></p>

<ul>
<li>Repository URL: <a href="https://github.com/couchbase/couchbase-lite-android">https://github.com/couchbase/couchbase-lite-android</a></li>
<li>Add Additional Behavior: Recursively update submodules</li>
</ul>


<h2>Install Android SDK</h2>

<p>The Android Emulator plugin expects to find the android-sdk in <code>/var/lib/jenkins/tools</code>, so install it there.</p>

<p><code>
cd /var/lib/jenkins/tools
wget http://dl.google.com/android/android-sdk_r23.0.2-linux.tgz
tar xvfz android-sdk_r23.0.2-linux.tgz
mv android-sdk-linux android-sdk
</code></p>

<p><strong>Add environment variables</strong></p>

<p>Run <code>vi /etc/profile.d/android.sh</code> and add:</p>

<p><code>
export ANDROID_HOME="/var/lib/jenkins/tools/android-sdk"
export PATH="$ANDROID_HOME/tools:$ANDROID_HOME/platform-tools:$PATH"
</code></p>

<p>And then reload the file with: <code>source /etc/profile</code></p>

<h2>Configure Android SDK</h2>

<p><code>
android update sdk -u --filter platform-tools,android-19
</code></p>

<p><strong>Install build tools</strong></p>

<p><code>
android list sdk --all | grep -i build
</code></p>

<p>and look for:</p>

<p><code>9- Android SDK Build-tools, revision 19.1</code></p>

<p>Now install by number:</p>

<p><code>
android update sdk -u --all --filter 8
</code></p>

<p><strong>Make Android SDK accessible by Jenkins</strong></p>

<p><code>
sudo chmod -R 755 /var/lib/jenkins/tools/android-sdk
</code></p>

<h2>Add build exec task</h2>

<p><code>
cat local.properties.example | sed 's/\/Applications\/Android Studio.app\/sdk/\/var\/lib\/jenkins\/tools\/android-sdk/g' &gt; local.properties
cp settings.gradle.example settings.gradle
./gradlew buildassembleDebugTest
</code></p>

<h2>Install and Configure AppThwack</h2>

<p><strong>Install Jenkins AppThwack plugin</strong></p>

<p>It is available from the Jenkins plugin manager</p>

<p><strong>Configure AppThwack</strong></p>

<ul>
<li>In Manage Jenkins / Configure, add your AppThwack Api key</li>
<li>In the Jenkins job config, add a new post-build action</li>
<li>Choose Run Tests on AppThwack</li>
<li>Hit &ldquo;Refresh&rdquo; button to pull latest settings from AppThwack</li>
<li>Choose Project and Device Pool</li>
<li>Under Application, enter <code>**/build/outputs/apk/couchbase-lite-android-debug-test-unaligned.apk</code></li>
<li>Under &ldquo;Choose tests to run&rdquo;, click ( ) JUnit/Robotium/Espresso</li>
<li>For <strong>Tests</strong> enter: <code>**/build/outputs/apk/couchbase-lite-android-debug-test-unaligned.apk</code></li>
</ul>


<h2>References</h2>

<ul>
<li><a href="http://blog.appthwack.com/continuous-integration-for-mobile-apps/">http://blog.appthwack.com/continuous-integration-for-mobile-apps/</a></li>
<li><a href="https://www.digitalocean.com/community/tutorials/how-to-build-android-apps-with-jenkins">https://www.digitalocean.com/community/tutorials/how-to-build-android-apps-with-jenkins</a></li>
<li><a href="https://wiki.jenkins-ci.org/display/JENKINS/Installing+Jenkins+on+Ubuntu">https://wiki.jenkins-ci.org/display/JENKINS/Installing+Jenkins+on+Ubuntu</a></li>
<li><a href="http://stackoverflow.com/questions/22333041/android-emulator-plugin-failed-to-initialize-backend-egl-display">http://stackoverflow.com/questions/22333041/android-emulator-plugin-failed-to-initialize-backend-egl-display</a></li>
<li><a href="http://stackoverflow.com/questions/17020298/android-sdks-build-tools-17-0-0-aapt-error-while-loading-shared-libraries-libz">http://stackoverflow.com/questions/17020298/android-sdks-build-tools-17-0-0-aapt-error-while-loading-shared-libraries-libz</a></li>
<li><a href="http://askubuntu.com/questions/147400/problems-with-eclipse-and-android-sdk">http://askubuntu.com/questions/147400/problems-with-eclipse-and-android-sdk</a></li>
<li><a href="http://stackoverflow.com/questions/15590239/emulator-warning-could-not-initialize-opengles-emulation-using-software-rende">http://stackoverflow.com/questions/15590239/emulator-warning-could-not-initialize-opengles-emulation-using-software-rende</a></li>
</ul>

]]></content>
  </entry>
  
</feed>
